Avast Free Antivírus vem agora com o Módulo Ransomware que mantém protegidos seus documentos/PDF.

C
ibercriminosos não mais poderão bloquear o acesso ao PC ou sequestrar seus arquivos e cobrar um resg
ate! Atualize e ganhe esta camada extra de segurança https://ava.st/3j83ltS

4AC5DDE2


Ensiko: um W
ebshell com recursos de ransomware
Este artigo discute o Ensiko, um webshell PHP com recursos de ran
somware voltado para várias plataformas, como Linux, Windows ou macOS, com PHP instalado. Ele pode c
ontrolar remotamente um sistema e aceitar comandos para serem executados na máquina infectada.
Ensik
o é um webshell PHP com recursos de ransomware voltado para várias plataformas, tais como Linux, Win
dows, macOS ou qualquer outra plataforma que tenha PHP instalado. O malware tem a capacidade de cont
rolar remotamente o sistema e aceitar comandos para realizar atividades maliciosas na máquina infect
ada.
Ele também pode executar comandos shell em um sistema infectado e enviar os resultados de volta
 ao invasor através de um shell reverso de PHP. É capaz de verificar servidores quanto à presença de
 outros webshells, desfigurar sites, enviar e-mails em massa, baixar arquivos remotos, divulgar info
rmações sobre o servidor afetado, ataques de força bruta contra protocolo de transferência de arquiv
os (FTP), cPanel e Telnet, sobrescrever arquivos com extensões especificadas e muito mais.
Detalhes 
técnicos
Autenticação Webshell
O malware pode ser protegido por senha. Para autenticação, o malware 
exibe uma página “Não encontrado” contendo um formulário de login oculto, conforme visto nas próxima
s duas figuras:

Figura 1. Página “Não encontrado” e formulário de login oculto

Figura 2. Código PH
P para autenticação de senha
A senha para este exemplo é “RaBiitch”, enquanto a figura a seguir most
ra o tráfego de rede capturado para uma solicitação de autenticação para o painel de webshell:

Figu
ra 3. Tráfego de rede capturado
 
Recursos Webshell
A seguir está uma lista dos recursos do Ensiko:

  
 

Figura 5. Lista de códigos de recursos do Ensiko
 
Análise de Ransomware
O malware usa PHP RIJ
NDAEL_128 com modo CBC para criptografar arquivos em um diretório de webshell e subdiretórios e anex
a nomes de arquivos com a extensão “.bak”. O seguinte snippet de código demonstra esse comportamento
 do malware:

Figura 6. Código mostrando o comportamento de criptografia

Figura 7. Código de cripto
grafia e descriptografia

Figura 8. Parte do Webshell com chave de ransomware

Figura 9. Registro de
 arquivos sendo criptografados

Figura 10. Arquivos criptografados no diretório

Figura 11. Solicita
ção POST para o servidor afetado
O malware também descarta um arquivo index.php e o define como a pá
gina padrão usando um arquivo .htaccess; o invasor também é notificado dessa ação por e-mail. O segu
inte snippet de código mostra esse comportamento:

Figura 12. Snippet de código para a página .htacc
ess descartada

Figura 13. A notificação que aparece quando index.php é acessado

Figura 14. Aparênc
ia da página index.php

Figura 15. Forma codificada de index.php

Figura 16. Aparência decodificada 
de index.php
 
Conjunto de Ferramentas
Para realizar mais tarefas em um sistema infectado, o malware
 pode carregar várias ferramentas adicionais em um sistema assim. A maioria dessas ferramentas é car
regada do Pastebin. O malware cria um diretório chamado tools_ensikology para armazená-las.

Figura 
17. Ferramentas carregadas do Pastebin
 
Steganologer
Existe uma técnica na qual um agente malicioso
 oculta o código dentro dos cabeçalhos do formato de arquivo de imagem (EXIF) de um arquivo de image
m e usa uma função PHP chamada exif_read_data para extrair e executar esse código em um servidor afe
tado. A função steganologer identifica imagens com cabeçalhos EXIF e os rotula como um registrador. 
Na captura de tela a seguir, test1.jpg e test2.jpg têm cabeçalhos EXIF com código oculto e são ident
ificados.

Figura 18. Arquivos com código oculto

Figura 19. Código para identificar arquivos com có
digo executável oculto

 
Varredura de backdoor 
Uma varredura backdoor verifica um determinado host
 remoto para a existência de um webshell de uma lista codificada.


Figuras 20 e 21. Código para enc
ontrar outros webshells no servidor afetado
 
Varredura de servidor remoto
Como uma varredura de bac
kdoor, a função de varredura do servidor remoto verifica o servidor remoto quanto à presença de outr
os webshells. No entanto, ao invés de usar uma lista codificada, ele aceita a entrada manual de arqu
ivos a serem pesquisados:


Figuras 22 e 23. Interface e código para verificação de outros webshells

 
Mass Overwrite
A função Mass Overwrite pode reescrever/anexar o conteúdo de todos os arquivos com
 extensões e diretórios especificados, incluindo todos os subdiretórios de um webshell


Figuras 24 
e 25. Interface do usuário e código para sobrescrever arquivos.
 
Conclusão
Ensiko é um webshell usa
do por um invasor que permite a administração remota, criptografia de arquivos e muitos outros recur
sos em um servidor da web comprometido. Um método comum para implantar o webshell é explorar vulnera
bilidades de aplicações da web ou * obter acesso a um servidor já comprometido. Além disso, o Ensiko
 tem capacidade de ransomware para criptografar arquivos em um servidor da web infectado usando o al
goritmo de criptografia RIJNDAEL. Também é capaz de verificar servidores quanto à presença de outros
 webshells, desfigurar sites, enviar e-mails em massa, baixar arquivos remotos, divulgar informações
 sobre o servidor afetado, obter acesso a bancos de dados, executar ataques de força bruta contra pr
otocolo de transferência de arquivos (FTP) , cPanel e Telnet, sobrescrevendo arquivos com extensões 
especificadas e muito mais.
 
Indicadores de compromisso

 

 

4AC5DDE2

Veja como o webshell #Ensi
ko vem sendo usado para controlar remotamente servidores, ataques de #ransomware, exfiltração de dad
os e mais.