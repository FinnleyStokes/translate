Veja como o webshell #Ensiko vem sendo usado para controlar remotamente servidores, ataques de #rans
omware, exfiltração de dados e mais.

4AC5DDE2

Avast Free Antivírus vem agora com o Módulo Ransomwa
re que mantém protegidos seus documentos/PDF.

Cibercriminosos não mais poderão bloquear o acesso ao
 PC ou sequestrar seus arquivos e cobrar um resgate! Atualize e ganhe esta camada extra de segurança
 https://ava.st/3j83ltS

4AC5DDE2


Ensiko: um Webshell com recursos de ransomware
Este artigo discu
te o Ensiko, um webshell PHP com recursos de ransomware voltado para várias plataformas, como Linux,
 Windows ou macOS, com PHP instalado. Ele pode controlar remotamente um sistema e aceitar comandos p
ara serem executados na máquina infectada.
Ensiko é um webshell PHP com recursos de ransomware volta
do para várias plataformas, tais como Linux, Windows, macOS ou qualquer outra plataforma que tenha P
HP instalado. O malware tem a capacidade de controlar remotamente o sistema e aceitar comandos para 
realizar atividades maliciosas na máquina infectada.
Ele também pode executar comandos shell em um s
istema infectado e enviar os resultados de volta ao invasor através de um shell reverso de PHP. É ca
paz de verificar servidores quanto à presença de outros webshells, desfigurar sites, enviar e-mails 
em massa, baixar arquivos remotos, divulgar informações sobre o servidor afetado, ataques de força b
ruta contra protocolo de transferência de arquivos (FTP), cPanel e Telnet, sobrescrever arquivos com
 extensões especificadas e muito mais.
Detalhes técnicos
Autenticação Webshell
O malware pode ser pr
otegido por senha. Para autenticação, o malware exibe uma página “Não encontrado” contendo um formul
ário de login oculto, conforme visto nas próximas duas figuras:

Figura 1. Página “Não encontrado” e
 formulário de login oculto

Figura 2. Código PHP para autenticação de senha
A senha para este exemp
lo é “RaBiitch”, enquanto a figura a seguir mostra o tráfego de rede capturado para uma solicitação 
de autenticação para o painel de webshell:

Figura 3. Tráfego de rede capturado
 
Recursos Webshell

A seguir está uma lista dos recursos do Ensiko:
  
 

Figura 5. Lista de códigos de recursos do Ensi
ko
 
Análise de Ransomware
O malware usa PHP RIJNDAEL_128 com modo CBC para criptografar arquivos em
 um diretório de webshell e subdiretórios e anexa nomes de arquivos com a extensão “.bak”. O seguint
e snippet de código demonstra esse comportamento do malware:

Figura 6. Código mostrando o comportam
ento de criptografia

Figura 7. Código de criptografia e descriptografia

Figura 8. Parte do Webshel
l com chave de ransomware

Figura 9. Registro de arquivos sendo criptografados

Figura 10. Arquivos 
criptografados no diretório

Figura 11. Solicitação POST para o servidor afetado
O malware também de
scarta um arquivo index.php e o define como a página padrão usando um arquivo .htaccess; o invasor t
ambém é notificado dessa ação por e-mail. O seguinte snippet de código mostra esse comportamento:

F
igura 12. Snippet de código para a página .htaccess descartada

Figura 13. A notificação que aparece
 quando index.php é acessado

Figura 14. Aparência da página index.php

Figura 15. Forma codificada 
de index.php

Figura 16. Aparência decodificada de index.php
 
Conjunto de Ferramentas
Para realizar
 mais tarefas em um sistema infectado, o malware pode carregar várias ferramentas adicionais em um s
istema assim. A maioria dessas ferramentas é carregada do Pastebin. O malware cria um diretório cham
ado tools_ensikology para armazená-las.

Figura 17. Ferramentas carregadas do Pastebin
 
Steganologe
r
Existe uma técnica na qual um agente malicioso oculta o código dentro dos cabeçalhos do formato de
 arquivo de imagem (EXIF) de um arquivo de imagem e usa uma função PHP chamada exif_read_data para e
xtrair e executar esse código em um servidor afetado. A função steganologer identifica imagens com c
abeçalhos EXIF e os rotula como um registrador. Na captura de tela a seguir, test1.jpg e test2.jpg t
êm cabeçalhos EXIF com código oculto e são identificados.

Figura 18. Arquivos com código oculto

Fi
gura 19. Código para identificar arquivos com código executável oculto

 
Varredura de backdoor 
Uma
 varredura backdoor verifica um determinado host remoto para a existência de um webshell de uma list
a codificada.


Figuras 20 e 21. Código para encontrar outros webshells no servidor afetado
 
Varred
ura de servidor remoto
Como uma varredura de backdoor, a função de varredura do servidor remoto veri
fica o servidor remoto quanto à presença de outros webshells. No entanto, ao invés de usar uma lista
 codificada, ele aceita a entrada manual de arquivos a serem pesquisados:


Figuras 22 e 23. Interfa
ce e código para verificação de outros webshells
 
Mass Overwrite
A função Mass Overwrite pode reesc
rever/anexar o conteúdo de todos os arquivos com extensões e diretórios especificados, incluindo tod
os os subdiretórios de um webshell


Figuras 24 e 25. Interface do usuário e código para sobrescreve
r arquivos.
 
Conclusão
Ensiko é um webshell usado por um invasor que permite a administração remota
, criptografia de arquivos e muitos outros recursos em um servidor da web comprometido. Um método co
mum para implantar o webshell é explorar vulnerabilidades de aplicações da web ou * obter acesso a u
m servidor já comprometido. Além disso, o Ensiko tem capacidade de ransomware para criptografar arqu
ivos em um servidor da web infectado usando o algoritmo de criptografia RIJNDAEL. Também é capaz de 
verificar servidores quanto à presença de outros webshells, desfigurar sites, enviar e-mails em mass
a, baixar arquivos remotos, divulgar informações sobre o servidor afetado, obter acesso a bancos de 
dados, executar ataques de força bruta contra protocolo de transferência de arquivos (FTP) , cPanel 
e Telnet, sobrescrevendo arquivos com extensões especificadas e muito mais.
 
Indicadores de comprom
isso

 

 